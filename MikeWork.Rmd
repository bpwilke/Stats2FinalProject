---
title: "MikeWork"
author: "Michael Landrum"
date: "4/3/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r loading, include=FALSE, echo=FALSE}
library(kableExtra) # to make uber sexy tables for output
library(pastecs) # for easy descriptive statistics
#library(ggbiplot) # implementation of biplot using ggplot2 for plotting PCs
library(Amelia) # cool library for exploring missing data
library(ROCR) # for ROC plots and AUC calculations

setwd("~/Documents/Stats2FinalProject")

BBHOFRaw <- read.table("MLBHOF-tab.new.dat.txt", sep="\t", header=FALSE)

colnames(BBHOFRaw) <- c("Name","NumSeasonsPlayed", "GamesPlayed", 
                        "OfficialAtBats", "RunsScored", "Hits", "Doubles", "Triples", 
                        "HomeRuns", "RunsBattedIn", "Walks", "Strikeouts", "BattingAvg", 
                        "OnBasePct", "SluggingPct", "AdjustedProduction", "BattingRuns", 
                        "AdjustedBattingRuns", "RunsCreated", "StolenBases", "CaughtStealing", 
                        "StolenBaseRuns", "FieldingAvg", "FieldingRuns", "PrimaryPositionPlayed", 
                        "TotalPlayerRating", "HOFMembership")
colsNoName <- c("NumSeasonsPlayed", "GamesPlayed", 
                        "OfficialAtBats", "RunsScored", "Hits", "Doubles", "Triples", 
                        "HomeRuns", "RunsBattedIn", "Walks", "Strikeouts", "BattingAvg", 
                        "OnBasePct", "SluggingPct", "AdjustedProduction", "BattingRuns", 
                        "AdjustedBattingRuns", "RunsCreated", "StolenBases",  
                        "FieldingAvg", "FieldingRuns", "PrimaryPositionPlayed", 
                        "TotalPlayerRating", "HOFMembership")
                        
BBHOFRaw$Name <- as.character(BBHOFRaw$Name)

BBHOFRaw$Strikeouts[BBHOFRaw$Strikeouts == "."] <- NA
BBHOFRaw$Strikeouts <- as.integer(BBHOFRaw$Strikeouts)

BBHOFRaw$StolenBases[BBHOFRaw$StolenBases == "."] <- NA
BBHOFRaw$StolenBases <- as.integer(BBHOFRaw$StolenBases)

BBHOFRaw$CaughtStealing[BBHOFRaw$CaughtStealing == "."] <- NA
BBHOFRaw$CaughtStealing <- as.integer(BBHOFRaw$CaughtStealing)

BBHOFRaw$StolenBaseRuns[BBHOFRaw$StolenBaseRuns == "."] <- NA
BBHOFRaw$StolenBaseRuns <- as.integer(BBHOFRaw$StolenBaseRuns)

BBHOFRaw$HOFMembership[BBHOFRaw$HOFMembership == 2] <- 1
```

## Adding onto your work

Ideally we find a model that doesn't use categories we can't easily grab for current players. Unfortunately "TotalPlayerRating" was one of the best predictors for HoF, which makes sense since that was likely the goal of the stat: to determine how good the player is. With this in mind, I wanted to see how they come up with this stat, and if we could proceed without it. 

I created a multiple linear regression model using the categories we can easily get off the web for current players vs this Total Player Rating.

```{r tpr, echo=TRUE}

tpr <- lm(TotalPlayerRating ~ OfficialAtBats + RunsScored + Hits + Doubles + Triples +
            HomeRuns + RunsBattedIn + Walks + Strikeouts + BattingAvg + OnBasePct +
            SluggingPct + StolenBases + CaughtStealing, data=BBHOFRaw)

summary(tpr)

```

So as I was hoping (and a little expected), this stat is basically a linear combinations of the basic stats plus some defense adjustment (r^2 jumps to 0.8394 when adding fielding runs) and then ballpark/era adjustments that we can't really get. But this is pretty good news because we can likely toss TotalPlayerRating and get good results.

K so with that, we want to just look at the "basic stats" and create a model using those. Here are those columns and then created a new DF using them. (Removed caught steeling due to the high number of NAs)


```{r goodCols, echo=TRUE}

newcols <- c("NumSeasonsPlayed", "GamesPlayed", 
             "OfficialAtBats", "RunsScored", "Hits", "Doubles", "Triples", 
             "HomeRuns", "RunsBattedIn", "Walks", "Strikeouts", "BattingAvg", 
             "OnBasePct", "SluggingPct", "StolenBases", 
             "PrimaryPositionPlayed", "HOFMembership") 

BBHOF_logistic <- BBHOFRaw[, newcols]

```

And then using your code to get an accuracy percentage:

```{r newModel1, echo=FALSE}
## all code from previous
set.seed(100) 
sample <- sample.int(n=nrow(BBHOF_logistic), size=floor(.90*nrow(BBHOF_logistic)), replace=FALSE)
train <- BBHOF_logistic[sample, ]
test  <- BBHOF_logistic[-sample, ]
model <- glm(train$HOFMembership ~., family=binomial(link='logit'),data=train)
summary(model)
fittedresults <- predict(model, newdata=test, type='response')
#sum(is.na(fittedresults))
fittedresults <- ifelse(fittedresults > 0.5, 1, 0)
misClasificError <- mean(fittedresults != test$HOFMembership, na.rm=TRUE) 
print(paste('Accuracy',1-misClasificError))

```

Hurray 96.49% again! But I think there's some cheating going on here. Basically like 1% of players are HoF (I'm making this number up), so any model will get 95%+ if they just said no to everyone. So I'm not completely sure this model is as good. It's also VERY odd to me that batting average doesn't play a huge roll in this as I'm pretty sure that and Home Runs were the only categories people cared about back in the day.

Then I realized it had to do with the amount of at bats. We have a bunch of guys in here with good batting averages but didn't play long enough to get into the HoF. I did some digging around and saw that no player made the HoF with less than 7000 at bats, so we should just look at those players, to compare models.

Here's the accuracy percentage, including all variables, but just for players with 7000+ at bats, followed by the new model with just the basic stats.

```{r newModel2, echo=FALSE}

## just players with 7000+ at bats, but with all the non-name columns
BBHOF_logistic <- BBHOFRaw[ BBHOFRaw$OfficialAtBats>7000, colsNoName]

set.seed(100) 
sample <- sample.int(n=nrow(BBHOF_logistic), size=floor(.90*nrow(BBHOF_logistic)), replace=FALSE)
train <- BBHOF_logistic[sample, ]
test  <- BBHOF_logistic[-sample, ]
model <- glm(train$HOFMembership ~., family=binomial(link='logit'),data=train)
summary(model)
fittedresults <- predict(model, newdata=test, type='response')
#sum(is.na(fittedresults))
fittedresults <- ifelse(fittedresults > 0.5, 1, 0)
misClasificError <- mean(fittedresults != test$HOFMembership, na.rm=TRUE) 
print(paste('Accuracy',1-misClasificError))


BBHOF_logistic <- BBHOFRaw[ BBHOFRaw$OfficialAtBats>7000, newcols ]

set.seed(100) 
sample <- sample.int(n=nrow(BBHOF_logistic), size=floor(.90*nrow(BBHOF_logistic)), replace=FALSE)
train <- BBHOF_logistic[sample, ]
test  <- BBHOF_logistic[-sample, ]
model <- glm(train$HOFMembership ~., family=binomial(link='logit'),data=train)
summary(model)
fittedresults <- predict(model, newdata=test, type='response')
#sum(is.na(fittedresults))
fittedresults <- ifelse(fittedresults > 0.5, 1, 0)
misClasificError <- mean(fittedresults != test$HOFMembership, na.rm=TRUE) 
print(paste('Accuracy',1-misClasificError))

```

So, both are 68.4% at this seed which is a good sign. We should be able to proceed without the TotalPlayerRating or the other non-box score statistics in our model. We should start trying to simplify our model while maintaining this accuracy.

